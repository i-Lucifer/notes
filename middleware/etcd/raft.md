[TOC]

## raft算法

### 概述

- Raft是一个用户管理日志一致性的协议。

- 它将分布式一致性问题分解问多个子问题
  - Leader选举  Leader election

- 日志复制 Log replication

- 安全性 Safety

- 日志压缩 Log Compaction

- Raft使用更强的假设来减少需要考虑的状态，使之变得易于理解和实现。
  - 假设日志同步失败。。。

- 假设选举失败。。。

### 三种角色

- Raft将系统(多台机器)中的角色分为Leader领导者、Follower跟随者、Candidate候选者。
- 我们可以理解为人，人可以候选，投票，也可以当领导人，既然是有选举，就有任期。
- (字正腔圆) Raft要求系统在任意时刻最多只有一个Leader，正常工作期间只有Leader和Followers，Raft算法将时间分为任期。

### 角色流程

- Leader 接受客户端请求、并向Follower同步日志，当日志同步到大多数节点后告诉Follower提交日志。

- Follower 接受并持久化Leader同步的日志，在Leader告知日志可以提交之后，提交日志。

- Candidate Leader选举过程中的临时角色。

### Term 任期

- 任期时间长度不固定，一般也不相等

- 任期用连续的数组表示 比如 1 2 3 4期，美国第23届总统

- 每一个任期的开始都是一次选举

- 一个或多个候选人试图竞争

- 被选中的候选人在任期内担任领导人

- 如果选票被瓜分，可能无领导人，则会开始另外一个任期

- 一个任期最多一个领导 最多一位总统

### RPC协议

- 这里的etcd存疑
- 节点之间数据通讯需要协议，etcd中的节点数据交互用的是RPC
- ectd有三个RPC通道
  - RequestVote(投票) RPC：候选人在选举期间发起。

- AppendEntries:领导人发起的一种心跳机制，复制日志也在该命令中完成。

- Install Snapshot(快照) RPC：领导者使用该RPC发送快照给太落后的追随者。

  简单来说，就是一个选举通道，一个全量同步通道，一个增量同步通道。



### leader选举规则
